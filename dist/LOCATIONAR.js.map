{"version":3,"sources":["webpack://LOCATIONAR/webpack/universalModuleDefinition","webpack://LOCATIONAR/webpack/bootstrap","webpack://LOCATIONAR/./src/GeoMath.ts","webpack://LOCATIONAR/./src/Source.ts","webpack://LOCATIONAR/./src/LocationProvider.ts","webpack://LOCATIONAR/./src/GpsLocation.ts","webpack://LOCATIONAR/external \"THREE\"","webpack://LOCATIONAR/./src/DirectionProvider.ts","webpack://LOCATIONAR/./src/LOCATIONAR.ts","webpack://LOCATIONAR/./src/Controller.ts","webpack://LOCATIONAR/./src/BrightnessProvider.ts"],"names":["root","factory","exports","module","require","define","amd","window","__WEBPACK_EXTERNAL_MODULE__4__","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","GeoMath","degToRad","deg","radToDeg","rad","limit","min","max","Math","getFlatCoordDistance","pos1","pos2","dLat","this","x","dLon","z","a","sin","cos","atan2","sqrt","EARTHRADIUS","coordTo3dSpace","gpsPosition","gpsZero","dAlt","y","coordOffsetGpsSpace","localOffset","PI","Source","parameters","parent","document","body","canvas","onResize","camera","deviceId","facingMode","sourceWidth","sourceHeight","displayWidth","displayHeight","setParameters","undefined","console","info","source","rendererDom","onResizeElement","copyElementSizeTo","that","initialize","then","params","aspect","updateProjectionMatrix","addEventListener","_this","Promise","resolve","reject","webcam","_initSourceWebcam","domElement","appendChild","message","positionSourceDomElement","dispose","removeChild","screenWidth","innerWidth","screenHeight","innerHeight","HTMLVideoElement","videoWidth","videoHeight","sourceAspect","newWidth","style","width","marginLeft","height","marginTop","newHeight","warn","otherElement","parseInt","onReady","onError","createElement","setAttribute","navigator","mediaDevices","enumerateDevices","getUserMedia","fctName","devices","userMediaConstraints","audio","video","ideal","exact","stream","srcObject","play","event","catch","error","position","top","left","zIndex","newValue","default","GpsLocation_1","three_1","LocationProvider","cameraHeight","callback","useGpsAltitude","locationProvider","localPosition","Vector3","gpsOptions","enableHighAccuracy","maximumAge","timeout","Infinity","geolocation","watchID","watchPosition","updatePosition","onLocationError","getLocation","getDebug","setCameraHeight","setGpsZero","clearWatch","coords","longitude","latitude","altitude","gps","positionRaw","GpsLocation","code","PERMISSION_DENIED","POSITION_UNAVAILABLE","TIMEOUT","GeoMath_1","DirectionProvider","directionProvider","alphaOffset","enabled","debug","alpha","beta","gamma","absolute","quaternion","Quaternion","targetQuanternion","screenOrientation","zee","euler","Euler","q0","q1","scope","onDeviceOrientationChangeEvent","updateDeviceOrientation","onScreenOrientationChangeEvent","orientation","connect","getDirection","device","orient","setObjectQuaternion","disconnect","set","setFromEuler","multiply","setFromAxisAngle","slerp","angleTo","removeEventListener","Source_1","Controller_1","Controller","LocationProvider_1","DirectionProvider_1","BrightnessProvider_1","BrightnessProvider","gpsTarget","sourceParams","locProvider","loc","pos","dirProvider","dir","qat","w","getSource","getLocProvider","getDirProvider","luxProvider","illuminance","avalible","sensor_1","AmbientLightSensor","onerror","onSensorError","onreading","start","isAvalible","getIlluminance","getBrightness","log","LN10","getLightPower"],"mappings":"CAAA,SAAAA,EAAAC,GACA,iBAAAC,SAAA,iBAAAC,OACAA,OAAAD,QAAAD,EAAAG,QAAA,UACA,mBAAAC,eAAAC,IACAD,OAAA,UAAAJ,GACA,iBAAAC,QACAA,QAAA,WAAAD,EAAAG,QAAA,UAEAJ,EAAA,WAAAC,EAAAD,EAAA,OARA,CASCO,OAAA,SAAAC,GACD,mBCTA,IAAAC,EAAA,GAGA,SAAAC,EAAAC,GAGA,GAAAF,EAAAE,GACA,OAAAF,EAAAE,GAAAT,QAGA,IAAAC,EAAAM,EAAAE,GAAA,CACAC,EAAAD,EACAE,GAAA,EACAX,QAAA,IAUA,OANAY,EAAAH,GAAAI,KAAAZ,EAAAD,QAAAC,IAAAD,QAAAQ,GAGAP,EAAAU,GAAA,EAGAV,EAAAD,QA0DA,OArDAQ,EAAAM,EAAAF,EAGAJ,EAAAO,EAAAR,EAGAC,EAAAQ,EAAA,SAAAhB,EAAAiB,EAAAC,GACAV,EAAAW,EAAAnB,EAAAiB,IACAG,OAAAC,eAAArB,EAAAiB,EAAA,CAA0CK,YAAA,EAAAC,IAAAL,KAK1CV,EAAAgB,EAAA,SAAAxB,GACA,oBAAAyB,eAAAC,aACAN,OAAAC,eAAArB,EAAAyB,OAAAC,YAAA,CAAwDC,MAAA,WAExDP,OAAAC,eAAArB,EAAA,cAAiD2B,OAAA,KAQjDnB,EAAAoB,EAAA,SAAAD,EAAAE,GAEA,GADA,EAAAA,IAAAF,EAAAnB,EAAAmB,IACA,EAAAE,EAAA,OAAAF,EACA,KAAAE,GAAA,iBAAAF,QAAAG,WAAA,OAAAH,EACA,IAAAI,EAAAX,OAAAY,OAAA,MAGA,GAFAxB,EAAAgB,EAAAO,GACAX,OAAAC,eAAAU,EAAA,WAAyCT,YAAA,EAAAK,UACzC,EAAAE,GAAA,iBAAAF,EAAA,QAAAM,KAAAN,EAAAnB,EAAAQ,EAAAe,EAAAE,EAAA,SAAAA,GAAgH,OAAAN,EAAAM,IAAqBC,KAAA,KAAAD,IACrI,OAAAF,GAIAvB,EAAA2B,EAAA,SAAAlC,GACA,IAAAiB,EAAAjB,KAAA6B,WACA,WAA2B,OAAA7B,EAAA,SAC3B,WAAiC,OAAAA,GAEjC,OADAO,EAAAQ,EAAAE,EAAA,IAAAA,GACAA,GAIAV,EAAAW,EAAA,SAAAiB,EAAAC,GAAsD,OAAAjB,OAAAkB,UAAAC,eAAA1B,KAAAuB,EAAAC,IAGtD7B,EAAAgC,EAAA,GAIAhC,IAAAiC,EAAA,mFC3EA,IAAAC,EAAA,oBAAAA,KA0DA,OAtDeA,EAAAC,SAAd,SAAuBC,GACtB,MAAO,kBAAqBA,GAGfF,EAAAG,SAAd,SAAuBC,GACtB,OAAO,kBAAoBA,GAGdJ,EAAAK,MAAd,SAAoBpB,EAAeqB,EAAaC,GAC/C,OAAOC,KAAKD,IAAIC,KAAKF,IAAIrB,EAAOsB,GAAMD,IAGzBN,EAAAS,qBAAd,SAAmCC,EAAYC,GAC9C,IAAMC,EAAOC,KAAKZ,SAASU,EAAKG,EAAIJ,EAAKI,GACnCC,EAAOF,KAAKZ,SAASU,EAAKK,EAAIN,EAAKM,GAEnCC,EACLT,KAAKU,IAAIN,EAAO,GAAKJ,KAAKU,IAAIN,EAAO,GACrCJ,KAAKU,IAAIH,EAAO,GAAKP,KAAKU,IAAIH,EAAO,GAAKP,KAAKW,IAAIT,EAAKI,GAAKN,KAAKW,IAAIR,EAAKG,GAEtEzC,EAAImC,KAAKY,MAAMZ,KAAKa,KAAKJ,GAAIT,KAAKa,KAAK,EAAIJ,IAEjD,OAAO,EAAIjB,EAAQsB,YAAcjD,GAMpB2B,EAAAuB,eAAd,SAA6BC,EAAmBC,GAG/C,IAAMb,EAAOC,KAAKZ,SAASuB,EAAYV,EAAIW,EAAQX,GAC7CC,EAAOF,KAAKZ,SAASuB,EAAYR,EAAIS,EAAQT,GAC7CU,EAAOF,EAAYG,EAAIF,EAAQE,EAKrC,MAAO,CAAEb,IAHOd,EAAQsB,YAAcV,GAGhBe,EAAGD,EAAMV,EAFfhB,EAAQsB,YAAcP,EAAOP,KAAKW,IAAIN,KAAKZ,SAASwB,EAAQX,MAK/Dd,EAAA4B,oBAAd,SAAkCJ,EAAmBK,GAGpD,IAAMjB,EAAOiB,EAAYf,EAAId,EAAQsB,YAC/BP,EAAOc,EAAYb,EAAIR,KAAKW,IAAIN,KAAKZ,SAASuB,EAAYV,IAAMd,EAAQsB,YACxEI,EAAOF,EAAYG,EAAIE,EAAYF,EAEzC,MAAO,CACNb,EAAGU,EAAYV,EAAID,KAAKV,SAASS,GACjCe,EAAGD,EACHV,EAAGQ,EAAYR,EAAIH,KAAKV,SAASY,KAtDrBf,EAAAsB,YAAc,OACdtB,EAAA8B,GAAK,kBAwDpB9B,EA1DA,GAAa1C,EAAA0C,yFCWb,IAAA+B,EAAA,WAIC,SAAAA,EAAYC,GAEXnB,KAAKmB,WAAa,CACjBC,OAAQC,SAASC,KACjBC,OAAQ,KACRC,SAAU,KACVC,OAAQ,KAGRC,SAAU,KACVC,WAAY,cAGZC,YAAa,IACbC,aAAc,IAEdC,aAAc,IACdC,cAAe,KAGhB/B,KAAKgC,cAAcb,QAEYc,IAA3BjC,KAAKmB,WAAWI,QACnBW,QAAQC,KAAK,2DAGTnC,KAAKmB,WAAWK,WACpBxB,KAAKmB,WAAWK,SAAW,SAACY,EAAgBC,GAC3CD,EAAOE,kBACHD,GAA+B,OAAhBA,GAClBD,EAAOG,kBAAkBF,KAK5B,IAAMG,EAAOxC,KACbA,KAAKyC,aAAaC,KAAK,WACtB,IAAMC,EAASH,EAAKrB,WACE,OAAlBwB,EAAOlB,SACVkB,EAAOlB,OAAOmB,OAASD,EAAOf,YAAce,EAAOd,aACnDc,EAAOlB,OAAOoB,0BAGf/F,OAAOgG,iBAAiB,SAAU,WAC7BH,EAAOpB,QAAUoB,EAAOnB,UAC3BmB,EAAOnB,SAASgB,EAAMG,EAAOpB,UAG3BoB,EAAOpB,QAAUoB,EAAOnB,UAC3BmB,EAAOnB,SAASgB,EAAMG,EAAOpB,UA4NjC,OAvNQL,EAAAnC,UAAA0D,WAAP,eAAAM,EAAA/C,KACC,OAAO,IAAIgD,QAAQ,SAACC,EAASC,GAC5B,IAeMC,EAASJ,EAAKK,kBAfJ,WACVL,EAAKM,YAKVN,EAAKT,kBACLS,EAAK5B,WAAWC,OAAOkC,YAAYP,EAAKM,YACxCJ,KANCC,EAAO,2BASO,SAACK,GAChBL,EAAOK,KAIR,GAAKJ,EAQL,OAJAJ,EAAKM,WAAaF,EAElBJ,EAAKS,2BAEET,EAPNG,EAAO,6CAWHhC,EAAAnC,UAAA0E,QAAP,WACKzD,KAAKmB,WAAWC,QAAUpB,KAAKqD,YAClCrD,KAAKmB,WAAWC,OAAOsC,YAAY1D,KAAKqD,aAInCnC,EAAAnC,UAAAuD,gBAAP,WACC,GAAKtC,KAAKqD,WAAV,CAKA,IAAMM,EAAc7G,OAAO8G,WACrBC,EAAe/G,OAAOgH,YACxBjC,EAAe,EACfD,EAAc,EAGd5B,KAAKqD,sBAAsBU,mBAC9BnC,EAAc5B,KAAKqD,WAAWW,WAC9BnC,EAAe7B,KAAKqD,WAAWY,aAIhC,IAAMC,EAAetC,EAAcC,EAKnC,GAHqB8B,EAAcE,EAGhBK,EAAc,CAEhC,IAAMC,EAAWD,EAAeL,EAChC7D,KAAKqD,WAAWe,MAAMC,MAAQF,EAAW,KACzCnE,KAAKqD,WAAWe,MAAME,aAAeH,EAAWR,GAAe,EAAI,KAGnE3D,KAAKqD,WAAWe,MAAMG,OAASV,EAAe,KAC9C7D,KAAKqD,WAAWe,MAAMI,UAAY,UAC5B,CAEN,IAAMC,EAAY,GAAKP,EAAeP,GACtC3D,KAAKqD,WAAWe,MAAMG,OAASE,EAAY,KAC3CzE,KAAKqD,WAAWe,MAAMI,YAAcC,EAAYZ,GAAgB,EAAI,KAGpE7D,KAAKqD,WAAWe,MAAMC,MAAQV,EAAc,KAC5C3D,KAAKqD,WAAWe,MAAME,WAAa,YAtCnCpC,QAAQwC,KAAK,wDA8CRxD,EAAAnC,UAAAwD,kBAAP,SAAyBoC,GACnB3E,KAAKqD,WAKNvG,OAAO8G,WAAa9G,OAAOgH,aAE9Ba,EAAaP,MAAMC,MAAQrE,KAAKqD,WAAWe,MAAMC,MACjDM,EAAaP,MAAMG,OAASvE,KAAKqD,WAAWe,MAAMG,OAClDI,EAAaP,MAAME,WAAatE,KAAKqD,WAAWe,MAAME,WACtDK,EAAaP,MAAMI,UAAYxE,KAAKqD,WAAWe,MAAMI,YAGrDG,EAAaP,MAAMG,OAASvE,KAAKqD,WAAWe,MAAMG,OAClDI,EAAaP,MAAMC,MAA6D,EAApDO,SAASD,EAAaP,MAAMG,OAAkB,IAAW,EAAI,KACzFI,EAAaP,MAAME,YACjBxH,OAAO8G,WAAagB,SAASD,EAAaP,MAAMC,MAAO,KAAO,EAAI,KACpEM,EAAaP,MAAMI,UAAY,KAhB/BtC,QAAQwC,KAAK,2DAoBPxD,EAAAnC,UAAAqE,kBAAR,SAA0ByB,EAAoBC,GAA9C,IAAA/B,EAAA/C,KACOqD,EAAahC,SAAS0D,cAAc,SAQ1C,GAPA1B,EAAW2B,aAAa,WAAY,IACpC3B,EAAW2B,aAAa,QAAS,IACjC3B,EAAW2B,aAAa,cAAe,IACvC3B,EAAWe,MAAMC,MAAQrE,KAAKmB,WAAWW,aAAe,KACxDuB,EAAWe,MAAMG,OAASvE,KAAKmB,WAAWY,cAAgB,UAI9BE,IAA3BgD,UAAUC,mBACkCjD,IAA5CgD,UAAUC,aAAaC,uBACiBlD,IAAxCgD,UAAUC,aAAaE,aACtB,CACD,IAAIC,EAAU,GASd,YAR+BpD,IAA3BgD,UAAUC,aACbG,EAAU,8BAC4CpD,IAA5CgD,UAAUC,aAAaC,iBACjCE,EAAU,+CACwCpD,IAAxCgD,UAAUC,aAAaE,eACjCC,EAAU,4CAEXP,EAAQ,kBAAoBO,EAAU,gCAkDvC,OA7CAJ,UAAUC,aACRC,mBACAzC,KAAK,SAAA4C,GACL,IAAMC,EAAuB,CAC5BC,OAAO,EACPC,MAAO,CACN9D,WAAYoB,EAAK5B,WAAWQ,WAC5B0C,MAAO,CACNqB,MAAO3C,EAAK5B,WAAWS,aAExB2C,OAAQ,CACPmB,MAAO3C,EAAK5B,WAAWU,gBAKtB,OAASkB,EAAK5B,WAAWO,WAC3B6D,EAA6BE,MAAM/D,SAAW,CAC9CiE,MAAO5C,EAAK5B,WAAWO,WAKzBuD,UAAUC,aACRE,aAAaG,GACb7C,KAAK,SAAiBkD,GAEtBvC,EAAWwC,UAAYD,EAEvBvE,SAASC,KAAKwB,iBAAiB,QAAS,WACvCO,EAAWyC,SAGZzC,EAAWP,iBAAiB,iBAAkB,SAAAiD,GAC7ClB,QAGDmB,MAAM,SAAAC,GACNnB,EAAQmB,OAGVD,MAAM,SAAAC,GACNnB,EAAQmB,KAGH5C,GAGAnC,EAAAnC,UAAAyE,yBAAR,WACKxD,KAAKqD,aACRrD,KAAKqD,WAAWe,MAAM8B,SAAW,WACjClG,KAAKqD,WAAWe,MAAM+B,IAAM,MAC5BnG,KAAKqD,WAAWe,MAAMgC,KAAO,MAC7BpG,KAAKqD,WAAWe,MAAMiC,OAAS,OAIzBnF,EAAAnC,UAAAiD,cAAR,SAAsBb,GACrB,GAAKA,EAIL,IAAK,IAAMzC,KAAOyC,EACjB,GAAIzC,EAAK,CACR,IAAM4H,EAAWnF,EAAWzC,GAE5B,QAAiBuD,IAAbqE,EAAwB,CAC3BpE,QAAQwC,KAAKhG,EAAM,6BACnB,SAKD,QAAqBuD,IAFCjC,KAAKmB,WAAmBzC,GAEd,CAC/BwD,QAAQwC,KAAKhG,EAAM,uCACnB,SAGAsB,KAAKmB,WAAmBzC,GAAO4H,IAIpCpF,EAjRA,GAAazE,EAAAyE,SAmRbzE,EAAA8J,QAAerF,iFCrSf,IAAAsF,EAAAvJ,EAAA,GAEAwJ,EAAAxJ,EAAA,GAEAyJ,EAAA,WAgBC,SAAAA,EACC9F,EACA+F,EACAC,EACAC,QAFA,IAAAF,MAAA,QACA,IAAAC,MAAA,SAAyDE,WACzD,IAAAD,OAAA,GAJD,IAAA9D,EAAA/C,KAgBC,GA/BOA,KAAA+G,cAAsB,IAAIN,EAAAO,QAE1BhH,KAAAY,QAAgB,IAAI6F,EAAAO,QAGpBhH,KAAA6G,gBAA0B,EAG1B7G,KAAAiH,WAAa,CAEpBC,oBAAoB,EACpBC,WAAY,EACZC,QAASC,KASTrH,KAAKY,QAAUA,EACfZ,KAAK2G,aAAeA,EACpB3G,KAAK6G,eAAiBA,EAEjBjG,IACJsB,QAAQC,KAAK,uBACbnC,KAAKY,QAAU,IAAI6F,EAAAO,SAIf/B,UAAUqC,YAER,CAMNtH,KAAKuH,QAAUtC,UAAUqC,YAAYE,cALrB,SAACtB,GAChBnD,EAAKpC,YAAcuF,EACnBnD,EAAK0E,iBACLb,EAAS7D,IAIT,SAAAkD,GAAS,OAAAlD,EAAK2E,gBAAgBzB,EAAO/D,QAAQC,OAC7CnC,KAAKiH,iBAVN/E,QAAQC,KAAK,gDAiEhB,OAlDQuE,EAAA3H,UAAA4I,YAAP,WACC,OAAO3H,KAAK+G,eAGNL,EAAA3H,UAAA6I,SAAP,WACC,OAAO5H,KAAKW,aAGN+F,EAAA3H,UAAA8I,gBAAP,SAAuBtD,GACtBvE,KAAK2G,aAAepC,GAGdmC,EAAA3H,UAAA+I,WAAP,SAAkBlH,GACjBZ,KAAKY,QAAUA,GAGT8F,EAAA3H,UAAA0E,QAAP,WACKzD,KAAKuH,SACRtC,UAAUqC,YAAYS,WAAW/H,KAAKuH,UAIhCb,EAAA3H,UAAA0I,eAAR,WACC,GAAIzH,KAAKW,YAAa,CACrB,IAAMqH,EAAShI,KAAKW,YAAYqH,OAChC,GAAIA,EAAOC,WAAaD,EAAOE,SAAU,CACxC,IAAMC,EAAWH,EAAOG,SAAWH,EAAOG,SAAW,EAC/C5D,EAASvE,KAAK6G,eAAiBsB,EAAWnI,KAAK2G,aAC/CyB,EAAM,IAAI3B,EAAAO,QAAQgB,EAAOE,SAAU3D,EAAQyD,EAAOC,WAClDI,EAAc,IAAI7B,EAAA8B,YAAYF,EAAKpI,KAAKY,SAC9CZ,KAAK+G,cAAgB,IAAIN,EAAAO,SAASqB,EAAYpI,EAAGoI,EAAYvH,EAAGuH,EAAYlI,MAKvEuG,EAAA3H,UAAA2I,gBAAR,SAAwBzB,EAAsBnB,GAC7C,OAAQmB,EAAMsC,MACb,KAAKtC,EAAMuC,kBACV1D,EAAQ,0CACR,MACD,KAAKmB,EAAMwC,qBACV3D,EAAQ,uCACR,MACD,KAAKmB,EAAMyC,QACV5D,EAAQ,6CACR,MACD,QACC,MAAMmB,IAGVS,EAlGA,GAAajK,EAAAiK,kGCJb,IAAAiC,EAAA1L,EAAA,GAEAqL,EAAA,WAWA,OANC,SAAY3H,EAAmBC,GAC9B,IAAMsF,EAAWyC,EAAAxJ,QAAQuB,eAAeC,EAAaC,GACrDZ,KAAKC,EAAIiG,EAASjG,EAClBD,KAAKc,EAAIoF,EAASpF,EAClBd,KAAKG,EAAI+F,EAAS/F,GATpB,GAAa1D,EAAA6L,6BCFb5L,EAAAD,QAAAM,iFCQA,IAAA4L,EAAA1L,EAAA,GAEAwJ,EAAAxJ,EAAA,GAEA2L,EAAA,WAqBC,SAAAA,EACChC,QAAA,IAAAA,MAAA,SAA2DiC,MAnBpD7I,KAAA8I,YAAcH,EAAAxJ,QAAQC,UAAU,IAEhCY,KAAA+I,SAAU,EACV/I,KAAAgJ,MAAQ,CAAEC,MAAO,EAAGC,KAAM,EAAGC,MAAO,EAAGC,UAAU,GAEjDpJ,KAAAqJ,WAAa,IAAI5C,EAAA6C,WACjBtJ,KAAAuJ,kBAAoB,IAAI9C,EAAA6C,WAExBtJ,KAAAwJ,kBAAoB,EAEpBxJ,KAAAyJ,IAAM,IAAIhD,EAAAO,QAAQ,EAAG,EAAG,GACxBhH,KAAA0J,MAAQ,IAAIjD,EAAAkD,MACZ3J,KAAA4J,GAAK,IAAInD,EAAA6C,WACTtJ,KAAA6J,GAAK,IAAIpD,EAAA6C,YAAY3J,KAAKa,KAAK,IAAM,EAAG,EAAGb,KAAKa,KAAK,KAQ5D,IAAMsJ,EAAQ9J,KAEdA,KAAK+J,+BAAiC,SAAAhE,GACrC+D,EAAME,wBAAwBjE,GAC9Ba,EAASkD,IAGV9J,KAAKiK,+BAAiC,WACrCH,EAAMN,kBAAqB1M,OAAOoN,aAA0B,GAG7DlK,KAAKmK,UAyEP,OAtEQvB,EAAA7J,UAAAqL,aAAP,WACC,OAAOpK,KAAKqJ,YAGNT,EAAA7J,UAAA6I,SAAP,WACC,OAAO5H,KAAKgJ,OAGNJ,EAAA7J,UAAAiL,wBAAP,SAA+BK,GAC9B,GAAKrK,KAAK+I,SAINsB,EAAQ,CACX,IAAMjB,EAAWiB,EAAOjB,SAClBH,EAAQoB,EAAOpB,MAAQN,EAAAxJ,QAAQC,SAASiL,EAAOpB,OAAS,EACxDC,EAAOmB,EAAOnB,KAAOP,EAAAxJ,QAAQC,SAASiL,EAAOnB,MAAQ,EACrDC,EAAQkB,EAAOlB,MAAQR,EAAAxJ,QAAQC,SAASiL,EAAOlB,OAAS,EAE9DnJ,KAAKgJ,MAAQ,CAAEC,MAAKA,EAAEC,KAAIA,EAAEC,MAAKA,EAAEC,SAAQA,GAE3C,IAAMkB,EAAStK,KAAKwJ,kBAAoBb,EAAAxJ,QAAQC,SAASY,KAAKwJ,mBAAqB,EAEnFxJ,KAAKuK,oBAAoBtB,EAAQjJ,KAAK8I,YAAaI,EAAMC,EAAOmB,KAI3D1B,EAAA7J,UAAA0E,QAAP,WACCzD,KAAKwK,cAIE5B,EAAA7J,UAAAwL,oBAAR,SAA4BtB,EAAeC,EAAcC,EAAemB,GACvEtK,KAAK0J,MAAMe,IAAIvB,EAAMD,GAAQE,EAAO,OAEpCnJ,KAAKuJ,kBAAkBmB,aAAa1K,KAAK0J,OACzC1J,KAAKuJ,kBAAkBoB,SAAS3K,KAAK6J,IACrC7J,KAAKuJ,kBAAkBoB,SAAS3K,KAAK4J,GAAGgB,iBAAiB5K,KAAKyJ,KAAMa,IAEpEtK,KAAKqJ,WAAWwB,MACf7K,KAAKuJ,kBACL5J,KAAKF,IAAI,GAAMO,KAAKqJ,WAAmByB,QAAQ9K,KAAKuJ,mBAAoB,MAIlEX,EAAA7J,UAAAoL,QAAR,WACCnK,KAAKiK,iCAELnN,OAAOgG,iBAAiB,oBAAqB9C,KAAKiK,gCAAgC,GAClFnN,OAAOgG,iBACN,4BACA9C,KAAK+J,gCACL,GAKD/J,KAAK+I,SAAU,GAGRH,EAAA7J,UAAAyL,WAAR,WACC1N,OAAOiO,oBAAoB,oBAAqB/K,KAAKiK,gCAAgC,GACrFnN,OAAOiO,oBACN,4BACA/K,KAAK+J,gCACL,GAGD/J,KAAK+I,SAAU,GAEjBH,EA5GA,GAAanM,EAAAmM,mGCZb,IAAAoC,EAAA/N,EAAA,GASCR,EAAAyE,OATQ8J,EAAA9J,OACT,IAAA+J,EAAAhO,EAAA,GASCR,EAAAyO,WATQD,EAAAC,WACT,IAAAC,EAAAlO,EAAA,GASCR,EAAAiK,iBATQyE,EAAAzE,iBACT,IAAA0E,EAAAnO,EAAA,GASCR,EAAAmM,kBATQwC,EAAAxC,kBACT,IAAAyC,EAAApO,EAAA,GASCR,EAAA6O,mBATQD,EAAAC,mBACT,IAAA9E,EAAAvJ,EAAA,GASCR,EAAA6L,YATQ9B,EAAA8B,YACT,IAAAK,EAAA1L,EAAA,GASCR,EAAA0C,QATQwJ,EAAAxJ,uFCNT,IAAA6L,EAAA/N,EAAA,GACAkO,EAAAlO,EAAA,GACAmO,EAAAnO,EAAA,GAGAiO,EAAA,WAKC,SAAAA,EACCK,EACA9J,EAOAkF,EACApF,EACAiK,QAAA,IAAAA,MAAA,IAEAA,EAAa/J,OAASA,EACtB+J,EAAajK,OAASA,EAEtBvB,KAAKoC,OAAS,IAAI4I,EAAA9J,OAAOsK,GAEzBxL,KAAKyL,YAAc,IAAIN,EAAAzE,iBAAiB6E,EAAW5E,EAAc,SAAC+E,GACjE,IAAMC,EAAMD,EAAI/D,cAChBlG,EAAOyE,SAASjG,EAAI0L,EAAI1L,EACxBwB,EAAOyE,SAASpF,EAAI6K,EAAI7K,EACxBW,EAAOyE,SAAS/F,EAAIwL,EAAIxL,IAEzBH,KAAK4L,YAAc,IAAIR,EAAAxC,kBAAkB,SAACiD,GACzC,IAAMC,EAAMD,EAAIzB,eAChB3I,EAAO4H,WAAWpJ,EAAI6L,EAAI7L,EAC1BwB,EAAO4H,WAAWvI,EAAIgL,EAAIhL,EAC1BW,EAAO4H,WAAWlJ,EAAI2L,EAAI3L,EAC1BsB,EAAO4H,WAAW0C,EAAID,EAAIC,IAqB7B,OAjBQb,EAAAnM,UAAA0E,QAAP,WACCzD,KAAKoC,OAAOqB,UACZzD,KAAKyL,YAAYhI,UACjBzD,KAAK4L,YAAYnI,WAGXyH,EAAAnM,UAAAiN,UAAP,WACC,OAAOhM,KAAKoC,QAGN8I,EAAAnM,UAAAkN,eAAP,WACC,OAAOjM,KAAKyL,aAGNP,EAAAnM,UAAAmN,eAAP,WACC,OAAOlM,KAAK4L,aAEdV,EAvDA,GAAazO,EAAAyO,4FCLb,IAAAvC,EAAA1L,EAAA,GAEAqO,EAAA,WAIC,SAAAA,EAAY1E,QAAA,IAAAA,MAAA,SAAsDuF,MAAlE,IAAApJ,EAAA/C,KACC,GAJOA,KAAAoM,YAAsB,EACtBpM,KAAAqM,UAAoB,EAGvB,uBAAwBvP,OAAQ,CAEnC,IAAMwP,EAAS,IAAIC,mBACnBD,EAAOE,QAAUxM,KAAKyM,cAEtBH,EAAOI,UAAY,WAClB3J,EAAKqJ,YAAcE,EAAOF,YAC1BrJ,EAAKsJ,UAAW,EAChBzF,EAAS7D,IAGVuJ,EAAOK,aAEP3M,KAAKqM,UAAW,EAChBnK,QAAQC,KAAK,8CA8BhB,OA1BQmJ,EAAAvM,UAAA6N,WAAP,WACC,OAAO5M,KAAKqM,UAGNf,EAAAvM,UAAA8N,eAAP,WACC,OAAO7M,KAAKoM,aAGNd,EAAAvM,UAAA+N,cAAP,WACC,OAAOnE,EAAAxJ,QAAQK,MAAMG,KAAKoN,IAAI/M,KAAKoM,aAAezM,KAAKqN,KAAO,EAAK,EAAG,IAGhE1B,EAAAvM,UAAAkO,cAAP,SAAqBtC,GACpB,YADoB,IAAAA,MAAA,GACb,EAAIhC,EAAAxJ,QAAQ8B,GAAKjB,KAAK8M,gBAAkBnC,GAGxCW,EAAAvM,UAAA0N,cAAR,SAAsB1G,GAEI,oBAArBA,EAAME,MAAMvI,KAEfwE,QAAQC,KAAK,mEACkB,qBAArB4D,EAAME,MAAMvI,MACtBwE,QAAQC,KAAK,mDAEdD,QAAQC,KAAK4D,EAAME,MAAMvI,KAAMqI,EAAME,MAAM1C,UAE7C+H,EAjDA,GAAa7O,EAAA6O","file":"LOCATIONAR.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"THREE\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"THREE\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"LOCATIONAR\"] = factory(require(\"THREE\"));\n\telse\n\t\troot[\"LOCATIONAR\"] = factory(root[\"THREE\"]);\n})(window, function(__WEBPACK_EXTERNAL_MODULE__4__) {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 6);\n","export interface Vec3 {\r\n\tx: number;\r\n\ty: number;\r\n\tz: number;\r\n}\r\n\r\n// tslint:disable: max-classes-per-file\r\nexport class GeoMath {\r\n\tpublic static EARTHRADIUS = 6371000.0; // m\r\n\tpublic static PI = 3.1415926535897932;\r\n\r\n\tpublic static degToRad(deg: number): number {\r\n\t\treturn 0.0174532925199432 * deg; // (deg / 180) * Math.PI\r\n\t}\r\n\r\n\tpublic static radToDeg(rad: number): number {\r\n\t\treturn 57.29577951308232 * rad; // (rad / Math.PI) * 180\r\n\t}\r\n\r\n\tpublic static limit(value: number, min: number, max: number): number {\r\n\t\treturn Math.max(Math.min(value, max), min);\r\n\t}\r\n\r\n\tpublic static getFlatCoordDistance(pos1: Vec3, pos2: Vec3): number {\r\n\t\tconst dLat = this.degToRad(pos2.x - pos1.x);\r\n\t\tconst dLon = this.degToRad(pos2.z - pos1.z);\r\n\r\n\t\tconst a =\r\n\t\t\tMath.sin(dLat / 2) * Math.sin(dLat / 2) +\r\n\t\t\tMath.sin(dLon / 2) * Math.sin(dLon / 2) * Math.cos(pos1.x) * Math.cos(pos2.x);\r\n\r\n\t\tconst c = Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n\r\n\t\treturn 2 * GeoMath.EARTHRADIUS * c;\r\n\t}\r\n\r\n\t// lat[Latitude] North/South\r\n\t// lon[Longitude] West/East\r\n\r\n\tpublic static coordTo3dSpace(gpsPosition: Vec3, gpsZero: Vec3): Vec3 {\r\n\t\t// only approx, small distances http://www.movable-type.co.uk/scripts/latlong.html\r\n\r\n\t\tconst dLat = this.degToRad(gpsPosition.x - gpsZero.x);\r\n\t\tconst dLon = this.degToRad(gpsPosition.z - gpsZero.z);\r\n\t\tconst dAlt = gpsPosition.y - gpsZero.y;\r\n\r\n\t\tconst distLat = GeoMath.EARTHRADIUS * dLat;\r\n\t\tconst distLon = GeoMath.EARTHRADIUS * dLon * Math.cos(this.degToRad(gpsZero.x));\r\n\r\n\t\treturn { x: -distLat, y: dAlt, z: distLon };\r\n\t}\r\n\r\n\tpublic static coordOffsetGpsSpace(gpsPosition: Vec3, localOffset: Vec3): Vec3 {\r\n\t\t// only approx, small distances http://www.movable-type.co.uk/scripts/latlong.html\r\n\r\n\t\tconst dLat = localOffset.x / GeoMath.EARTHRADIUS;\r\n\t\tconst dLon = localOffset.z / Math.cos(this.degToRad(gpsPosition.x)) / GeoMath.EARTHRADIUS;\r\n\t\tconst dAlt = gpsPosition.y + localOffset.y;\r\n\r\n\t\treturn {\r\n\t\t\tx: gpsPosition.x + this.radToDeg(dLat),\r\n\t\t\ty: dAlt,\r\n\t\t\tz: gpsPosition.z + this.radToDeg(dLon)\r\n\t\t};\r\n\t}\r\n}\r\n","/**\r\n * @author JamesMilner / https://github.com/JamesMilnerUK\r\n * @author 0x4d\r\n */\r\n\r\nexport interface SourceParameters {\r\n\tparent: HTMLElement;\r\n\tcanvas: HTMLElement | null; // 0x4d\r\n\tonResize: ((source: Source, rendererDom: HTMLElement | null) => void) | null;\r\n\tcamera: { aspect: number; updateProjectionMatrix: () => void } | null;\r\n\tfacingMode: \"user\" | \"environment\";\r\n\tdeviceId: any;\r\n\tsourceWidth: number;\r\n\tsourceHeight: number;\r\n\tdisplayWidth: number;\r\n\tdisplayHeight: number;\r\n}\r\n\r\nexport class Source {\r\n\tpublic domElement: HTMLImageElement | HTMLVideoElement | undefined;\r\n\tprivate parameters: SourceParameters;\r\n\r\n\tconstructor(parameters: Partial<SourceParameters>) {\r\n\t\t// handle default parameters\r\n\t\tthis.parameters = {\r\n\t\t\tparent: document.body,\r\n\t\t\tcanvas: null, // 0x4d\r\n\t\t\tonResize: null,\r\n\t\t\tcamera: null,\r\n\r\n\t\t\t// Device id of the camera to use (optional)\r\n\t\t\tdeviceId: null,\r\n\t\t\tfacingMode: \"environment\",\r\n\r\n\t\t\t// resolution of at which we initialize in the source image\r\n\t\t\tsourceWidth: 640,\r\n\t\t\tsourceHeight: 480,\r\n\t\t\t// resolution displayed for the source\r\n\t\t\tdisplayWidth: 640,\r\n\t\t\tdisplayHeight: 480\r\n\t\t};\r\n\r\n\t\tthis.setParameters(parameters);\r\n\r\n\t\tif (this.parameters.canvas === undefined) {\r\n\t\t\tconsole.info(\"canvas have to be provided, otherwise resize won't work\");\r\n\t\t}\r\n\r\n\t\tif (!this.parameters.onResize) {\r\n\t\t\tthis.parameters.onResize = (source: Source, rendererDom: HTMLElement | null) => {\r\n\t\t\t\tsource.onResizeElement();\r\n\t\t\t\tif (rendererDom && rendererDom !== null) {\r\n\t\t\t\t\tsource.copyElementSizeTo(rendererDom);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tconst that = this;\r\n\t\tthis.initialize().then(() => {\r\n\t\t\tconst params = that.parameters;\r\n\t\t\tif (params.camera !== null) {\r\n\t\t\t\tparams.camera.aspect = params.sourceWidth / params.sourceHeight;\r\n\t\t\t\tparams.camera.updateProjectionMatrix();\r\n\t\t\t}\r\n\r\n\t\t\twindow.addEventListener(\"resize\", () => {\r\n\t\t\t\tif (params.canvas && params.onResize) {\r\n\t\t\t\t\tparams.onResize(that, params.canvas);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif (params.canvas && params.onResize) {\r\n\t\t\t\tparams.onResize(that, params.canvas);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tpublic initialize() {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tconst onReady = () => {\r\n\t\t\t\tif (!this.domElement) {\r\n\t\t\t\t\treject(\"domElement not defined\");\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.onResizeElement();\r\n\t\t\t\tthis.parameters.parent.appendChild(this.domElement);\r\n\t\t\t\tresolve();\r\n\t\t\t};\r\n\r\n\t\t\tconst onError = (message: Error | string) => {\r\n\t\t\t\treject(message);\r\n\t\t\t};\r\n\r\n\t\t\tconst webcam = this._initSourceWebcam(onReady, onError);\r\n\t\t\tif (!webcam) {\r\n\t\t\t\treject(\"Webcam source could not be established\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.domElement = webcam;\r\n\r\n\t\t\tthis.positionSourceDomElement();\r\n\r\n\t\t\treturn this;\r\n\t\t});\r\n\t}\r\n\r\n\tpublic dispose() {\r\n\t\tif (this.parameters.parent && this.domElement) {\r\n\t\t\tthis.parameters.parent.removeChild(this.domElement);\r\n\t\t}\r\n\t}\r\n\r\n\tpublic onResizeElement() {\r\n\t\tif (!this.domElement) {\r\n\t\t\tconsole.warn(\"Can't resize as domElement is not defined on source\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst screenWidth = window.innerWidth;\r\n\t\tconst screenHeight = window.innerHeight;\r\n\t\tlet sourceHeight = 0;\r\n\t\tlet sourceWidth = 0;\r\n\r\n\t\t// compute sourceWidth, sourceHeight\r\n\t\tif (this.domElement instanceof HTMLVideoElement) {\r\n\t\t\tsourceWidth = this.domElement.videoWidth;\r\n\t\t\tsourceHeight = this.domElement.videoHeight;\r\n\t\t}\r\n\r\n\t\t// compute sourceAspect\r\n\t\tconst sourceAspect = sourceWidth / sourceHeight;\r\n\t\t// compute screenAspect\r\n\t\tconst screenAspect = screenWidth / screenHeight;\r\n\r\n\t\t// if screenAspect < sourceAspect, then change the width, else change the height\r\n\t\tif (screenAspect < sourceAspect) {\r\n\t\t\t// compute newWidth and set .width/.marginLeft\r\n\t\t\tconst newWidth = sourceAspect * screenHeight;\r\n\t\t\tthis.domElement.style.width = newWidth + \"px\";\r\n\t\t\tthis.domElement.style.marginLeft = -(newWidth - screenWidth) / 2 + \"px\";\r\n\r\n\t\t\t// init style.height/.marginTop to normal value\r\n\t\t\tthis.domElement.style.height = screenHeight + \"px\";\r\n\t\t\tthis.domElement.style.marginTop = \"0px\";\r\n\t\t} else {\r\n\t\t\t// compute newHeight and set .height/.marginTop\r\n\t\t\tconst newHeight = 1 / (sourceAspect / screenWidth);\r\n\t\t\tthis.domElement.style.height = newHeight + \"px\";\r\n\t\t\tthis.domElement.style.marginTop = -(newHeight - screenHeight) / 2 + \"px\";\r\n\r\n\t\t\t// init style.width/.marginLeft to normal value\r\n\t\t\tthis.domElement.style.width = screenWidth + \"px\";\r\n\t\t\tthis.domElement.style.marginLeft = \"0px\";\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Copy the dimensions of the domElement of the source to another given domElement\r\n\t * @param otherElement the target element to copy the size to, from the Source dom element\r\n\t */\r\n\tpublic copyElementSizeTo(otherElement: HTMLElement) {\r\n\t\tif (!this.domElement) {\r\n\t\t\tconsole.warn(\"Cant set size to match domElement as it is not defined\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (window.innerWidth > window.innerHeight) {\r\n\t\t\t// landscape\r\n\t\t\totherElement.style.width = this.domElement.style.width;\r\n\t\t\totherElement.style.height = this.domElement.style.height;\r\n\t\t\totherElement.style.marginLeft = this.domElement.style.marginLeft;\r\n\t\t\totherElement.style.marginTop = this.domElement.style.marginTop;\r\n\t\t} else {\r\n\t\t\t// portrait\r\n\t\t\totherElement.style.height = this.domElement.style.height;\r\n\t\t\totherElement.style.width = (parseInt(otherElement.style.height as string, 10) * 4) / 3 + \"px\"; // ! as string\r\n\t\t\totherElement.style.marginLeft =\r\n\t\t\t\t(window.innerWidth - parseInt(otherElement.style.width, 10)) / 2 + \"px\";\r\n\t\t\totherElement.style.marginTop = \"0\";\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _initSourceWebcam(onReady: () => any, onError: (message: string) => any) {\r\n\t\tconst domElement = document.createElement(\"video\");\r\n\t\tdomElement.setAttribute(\"autoplay\", \"\");\r\n\t\tdomElement.setAttribute(\"muted\", \"\");\r\n\t\tdomElement.setAttribute(\"playsinline\", \"\");\r\n\t\tdomElement.style.width = this.parameters.displayWidth + \"px\";\r\n\t\tdomElement.style.height = this.parameters.displayHeight + \"px\";\r\n\r\n\t\t// check API is available\r\n\t\tif (\r\n\t\t\tnavigator.mediaDevices === undefined ||\r\n\t\t\tnavigator.mediaDevices.enumerateDevices === undefined ||\r\n\t\t\tnavigator.mediaDevices.getUserMedia === undefined\r\n\t\t) {\r\n\t\t\tlet fctName = \"\";\r\n\t\t\tif (navigator.mediaDevices === undefined) {\r\n\t\t\t\tfctName = \"navigator.mediaDevices\";\r\n\t\t\t} else if (navigator.mediaDevices.enumerateDevices === undefined) {\r\n\t\t\t\tfctName = \"navigator.mediaDevices.enumerateDevices\";\r\n\t\t\t} else if (navigator.mediaDevices.getUserMedia === undefined) {\r\n\t\t\t\tfctName = \"navigator.mediaDevices.getUserMedia\";\r\n\t\t\t}\r\n\t\t\tonError(\"WebRTC issue-! \" + fctName + \" not present in your browser\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// get available devices\r\n\t\tnavigator.mediaDevices\r\n\t\t\t.enumerateDevices()\r\n\t\t\t.then(devices => {\r\n\t\t\t\tconst userMediaConstraints = {\r\n\t\t\t\t\taudio: false,\r\n\t\t\t\t\tvideo: {\r\n\t\t\t\t\t\tfacingMode: this.parameters.facingMode,\r\n\t\t\t\t\t\twidth: {\r\n\t\t\t\t\t\t\tideal: this.parameters.sourceWidth\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\theight: {\r\n\t\t\t\t\t\t\tideal: this.parameters.sourceHeight\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif (null !== this.parameters.deviceId) {\r\n\t\t\t\t\t(userMediaConstraints as any).video.deviceId = {\r\n\t\t\t\t\t\texact: this.parameters.deviceId\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// get a device which satisfy the constraints\r\n\t\t\t\tnavigator.mediaDevices\r\n\t\t\t\t\t.getUserMedia(userMediaConstraints)\r\n\t\t\t\t\t.then(function success(stream) {\r\n\t\t\t\t\t\t// set the .src of the domElement\r\n\t\t\t\t\t\tdomElement.srcObject = stream;\r\n\t\t\t\t\t\t// to start the video, when it is possible to start it only on userevent. like in android\r\n\t\t\t\t\t\tdocument.body.addEventListener(\"click\", () => {\r\n\t\t\t\t\t\t\tdomElement.play();\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\tdomElement.addEventListener(\"loadedmetadata\", event => {\r\n\t\t\t\t\t\t\tonReady();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(error => {\r\n\t\t\t\t\t\tonError(error);\r\n\t\t\t\t\t});\r\n\t\t\t})\r\n\t\t\t.catch(error => {\r\n\t\t\t\tonError(error);\r\n\t\t\t});\r\n\r\n\t\treturn domElement;\r\n\t}\r\n\r\n\tprivate positionSourceDomElement() {\r\n\t\tif (this.domElement) {\r\n\t\t\tthis.domElement.style.position = \"absolute\";\r\n\t\t\tthis.domElement.style.top = \"0px\";\r\n\t\t\tthis.domElement.style.left = \"0px\";\r\n\t\t\tthis.domElement.style.zIndex = \"-2\";\r\n\t\t}\r\n\t}\r\n\r\n\tprivate setParameters(parameters: any) {\r\n\t\tif (!parameters) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tfor (const key in parameters) {\r\n\t\t\tif (key) {\r\n\t\t\t\tconst newValue = parameters[key];\r\n\r\n\t\t\t\tif (newValue === undefined) {\r\n\t\t\t\t\tconsole.warn(key + \"' parameter is undefined.\");\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst currentValue = (this.parameters as any)[key];\r\n\r\n\t\t\t\tif (currentValue === undefined) {\r\n\t\t\t\t\tconsole.warn(key + \"' is not a property of this Source.\");\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t(this.parameters as any)[key] = newValue;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport default Source;\r\n","import { GpsLocation } from \"./GpsLocation\";\r\nimport { Vec3 } from \"./GeoMath\";\r\nimport { Vector3 } from \"three\";\r\n\r\nexport class LocationProvider {\r\n\tprivate localPosition: Vec3 = new Vector3();\r\n\tprivate cameraHeight: number;\r\n\tprivate gpsZero: Vec3 = new Vector3();\r\n\r\n\tprivate gpsPosition: Position | undefined;\r\n\tprivate useGpsAltitude: boolean = false;\r\n\r\n\tprivate watchID: number | undefined;\r\n\tprivate gpsOptions = {\r\n\t\t// https://developer.mozilla.org/en-US/docs/Web/API/PositionOptions\r\n\t\tenableHighAccuracy: true,\r\n\t\tmaximumAge: 0,\r\n\t\ttimeout: Infinity\r\n\t};\r\n\r\n\tconstructor(\r\n\t\tgpsZero: Vec3,\r\n\t\tcameraHeight: number = 2.0,\r\n\t\tcallback: (locationProvider: LocationProvider) => void = locationProvider => undefined,\r\n\t\tuseGpsAltitude: boolean = false\r\n\t) {\r\n\t\tthis.gpsZero = gpsZero;\r\n\t\tthis.cameraHeight = cameraHeight;\r\n\t\tthis.useGpsAltitude = useGpsAltitude;\r\n\r\n\t\tif (!gpsZero) {\r\n\t\t\tconsole.info(\"gpsZero is required\");\r\n\t\t\tthis.gpsZero = new Vector3();\r\n\t\t}\r\n\r\n\t\t// https://developer.mozilla.org/en-US/docs/Web/API/Geolocation_API\r\n\t\tif (!navigator.geolocation) {\r\n\t\t\tconsole.info(\"Geolocation is not supported by your browser\");\r\n\t\t} else {\r\n\t\t\tconst success = (position: Position) => {\r\n\t\t\t\tthis.gpsPosition = position;\r\n\t\t\t\tthis.updatePosition();\r\n\t\t\t\tcallback(this);\r\n\t\t\t};\r\n\t\t\tthis.watchID = navigator.geolocation.watchPosition(\r\n\t\t\t\tsuccess,\r\n\t\t\t\terror => this.onLocationError(error, console.info),\r\n\t\t\t\tthis.gpsOptions\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\tpublic getLocation() {\r\n\t\treturn this.localPosition;\r\n\t}\r\n\r\n\tpublic getDebug() {\r\n\t\treturn this.gpsPosition;\r\n\t}\r\n\r\n\tpublic setCameraHeight(height: number) {\r\n\t\tthis.cameraHeight = height;\r\n\t}\r\n\r\n\tpublic setGpsZero(gpsZero: Vec3) {\r\n\t\tthis.gpsZero = gpsZero;\r\n\t}\r\n\r\n\tpublic dispose() {\r\n\t\tif (this.watchID) {\r\n\t\t\tnavigator.geolocation.clearWatch(this.watchID);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate updatePosition() {\r\n\t\tif (this.gpsPosition) {\r\n\t\t\tconst coords = this.gpsPosition.coords;\r\n\t\t\tif (coords.longitude && coords.latitude) {\r\n\t\t\t\tconst altitude = coords.altitude ? coords.altitude : 0; // TODO not all positions contain altitude\r\n\t\t\t\tconst height = this.useGpsAltitude ? altitude : this.cameraHeight;\r\n\t\t\t\tconst gps = new Vector3(coords.latitude, height, coords.longitude);\r\n\t\t\t\tconst positionRaw = new GpsLocation(gps, this.gpsZero);\r\n\t\t\t\tthis.localPosition = new Vector3(-positionRaw.x, positionRaw.y, positionRaw.z);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate onLocationError(error: PositionError, onError: (error: string) => void) {\r\n\t\tswitch (error.code) {\r\n\t\t\tcase error.PERMISSION_DENIED: // Error message when user denied permission to use Geolocation\r\n\t\t\t\tonError(\"User denied permission for Geolocation\");\r\n\t\t\t\tbreak;\r\n\t\t\tcase error.POSITION_UNAVAILABLE: // Error message for when the position is unavailable\r\n\t\t\t\tonError(\"Location information is unavailable\");\r\n\t\t\t\tbreak;\r\n\t\t\tcase error.TIMEOUT: // Error message when there occurs a time out\r\n\t\t\t\tonError(\"The request to get user location timedout\");\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tthrow error; // Error message when the error is unknown\r\n\t\t}\r\n\t}\r\n}\r\n","import { GeoMath, Vec3 } from \"./GeoMath\";\r\n\r\nexport class GpsLocation implements Vec3 {\r\n\tpublic x: number;\r\n\tpublic y: number;\r\n\tpublic z: number;\r\n\r\n\tconstructor(gpsPosition: Vec3, gpsZero: Vec3) {\r\n\t\tconst position = GeoMath.coordTo3dSpace(gpsPosition, gpsZero);\r\n\t\tthis.x = position.x;\r\n\t\tthis.y = position.y;\r\n\t\tthis.z = position.z;\r\n\t}\r\n}\r\n","module.exports = __WEBPACK_EXTERNAL_MODULE__4__;","/**\r\n * @author richt / http://richt.me\r\n * @author WestLangley / http://github.com/WestLangley\r\n * @author 0x4d / https://github.com/0b01001101\r\n *\r\n * W3C Device Orientation control (http://w3c.github.io/deviceorientation/spec-source-orientation.html)\r\n */\r\n\r\nimport { GeoMath } from \"./GeoMath\";\r\n\r\nimport { Vector3, Euler, Quaternion } from \"three\";\r\n\r\nexport class DirectionProvider {\r\n\t// this.object.rotation.reorder(\"YXZ\");\r\n\r\n\tprivate alphaOffset = GeoMath.degToRad(-90); // radians\r\n\r\n\tprivate enabled = true;\r\n\tprivate debug = { alpha: 0, beta: 0, gamma: 0, absolute: false };\r\n\r\n\tprivate quaternion = new Quaternion();\r\n\tprivate targetQuanternion = new Quaternion();\r\n\r\n\tprivate screenOrientation = 0;\r\n\r\n\tprivate zee = new Vector3(0, 0, 1);\r\n\tprivate euler = new Euler();\r\n\tprivate q0 = new Quaternion();\r\n\tprivate q1 = new Quaternion(-Math.sqrt(0.5), 0, 0, Math.sqrt(0.5)); // - PI/2 around the x-axis\r\n\r\n\tprivate onDeviceOrientationChangeEvent: (event: any) => void;\r\n\tprivate onScreenOrientationChangeEvent: () => void;\r\n\r\n\tconstructor(\r\n\t\tcallback: (directionProvider: DirectionProvider) => void = directionProvider => undefined\r\n\t) {\r\n\t\tconst scope = this;\r\n\r\n\t\tthis.onDeviceOrientationChangeEvent = event => {\r\n\t\t\tscope.updateDeviceOrientation(event);\r\n\t\t\tcallback(scope);\r\n\t\t};\r\n\r\n\t\tthis.onScreenOrientationChangeEvent = () => {\r\n\t\t\tscope.screenOrientation = (window.orientation as number) || 0; // deprecated soon https://developer.mozilla.org/en-US/docs/Web/API/Window/orientation\r\n\t\t};\r\n\r\n\t\tthis.connect();\r\n\t}\r\n\r\n\tpublic getDirection() {\r\n\t\treturn this.quaternion;\r\n\t}\r\n\r\n\tpublic getDebug() {\r\n\t\treturn this.debug;\r\n\t}\r\n\r\n\tpublic updateDeviceOrientation(device: DeviceOrientationEvent) {\r\n\t\tif (!this.enabled) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (device) {\r\n\t\t\tconst absolute = device.absolute;\r\n\t\t\tconst alpha = device.alpha ? GeoMath.degToRad(device.alpha) : 0; // Z\r\n\t\t\tconst beta = device.beta ? GeoMath.degToRad(device.beta) : 0; // X'\r\n\t\t\tconst gamma = device.gamma ? GeoMath.degToRad(device.gamma) : 0; // Y''\r\n\r\n\t\t\tthis.debug = { alpha, beta, gamma, absolute };\r\n\r\n\t\t\tconst orient = this.screenOrientation ? GeoMath.degToRad(this.screenOrientation) : 0; // O\r\n\r\n\t\t\tthis.setObjectQuaternion(alpha + this.alphaOffset, beta, gamma, orient);\r\n\t\t}\r\n\t}\r\n\r\n\tpublic dispose() {\r\n\t\tthis.disconnect();\r\n\t}\r\n\r\n\t// The angles alpha, beta and gamma form a set of intrinsic Tait-Bryan angles of type Z-X'-Y''\r\n\tprivate setObjectQuaternion(alpha: number, beta: number, gamma: number, orient: number) {\r\n\t\tthis.euler.set(beta, alpha, -gamma, \"YXZ\"); // 'ZXY' for the device, but 'YXZ' for us\r\n\r\n\t\tthis.targetQuanternion.setFromEuler(this.euler); // orient the device\r\n\t\tthis.targetQuanternion.multiply(this.q1); // camera looks out the back of the device, not the top\r\n\t\tthis.targetQuanternion.multiply(this.q0.setFromAxisAngle(this.zee, -orient)); // adjust for screen orientation\r\n\r\n\t\tthis.quaternion.slerp(\r\n\t\t\tthis.targetQuanternion,\r\n\t\t\tMath.min(10 * (this.quaternion as any).angleTo(this.targetQuanternion), 0.8)\r\n\t\t); // Interpolate between angles\r\n\t}\r\n\r\n\tprivate connect() {\r\n\t\tthis.onScreenOrientationChangeEvent();\r\n\r\n\t\twindow.addEventListener(\"orientationchange\", this.onScreenOrientationChangeEvent, false);\r\n\t\twindow.addEventListener(\r\n\t\t\t\"deviceorientationabsolute\",\r\n\t\t\tthis.onDeviceOrientationChangeEvent,\r\n\t\t\tfalse\r\n\t\t);\r\n\t\t// TODO Support other absolute deviceorientationevents [only supported in chrome?]\r\n\t\t// TODO AbsoluteOrientationSensor, compass.js, ...\r\n\r\n\t\tthis.enabled = true;\r\n\t}\r\n\r\n\tprivate disconnect() {\r\n\t\twindow.removeEventListener(\"orientationchange\", this.onScreenOrientationChangeEvent, false);\r\n\t\twindow.removeEventListener(\r\n\t\t\t\"deviceorientationabsolute\",\r\n\t\t\tthis.onDeviceOrientationChangeEvent,\r\n\t\t\tfalse\r\n\t\t);\r\n\r\n\t\tthis.enabled = false;\r\n\t}\r\n}\r\n","import { Source } from \"./Source\";\r\nimport { Controller } from \"./Controller\";\r\nimport { LocationProvider } from \"./LocationProvider\";\r\nimport { DirectionProvider } from \"./DirectionProvider\";\r\nimport { BrightnessProvider } from \"./BrightnessProvider\";\r\nimport { GpsLocation } from \"./GpsLocation\";\r\nimport { GeoMath } from \"./GeoMath\";\r\n\r\nexport {\r\n\tSource,\r\n\tController,\r\n\tLocationProvider,\r\n\tDirectionProvider,\r\n\tBrightnessProvider,\r\n\tGpsLocation,\r\n\tGeoMath\r\n};\r\n","import { Source, SourceParameters } from \"./Source\";\r\nimport { LocationProvider } from \"./LocationProvider\";\r\nimport { DirectionProvider } from \"./DirectionProvider\";\r\nimport { Vec3 } from \"./GeoMath\";\r\n\r\nexport class Controller {\r\n\tprivate source: Source;\r\n\tprivate locProvider: LocationProvider;\r\n\tprivate dirProvider: DirectionProvider;\r\n\r\n\tconstructor(\r\n\t\tgpsTarget: Vec3,\r\n\t\tcamera: {\r\n\t\t\taspect: number;\r\n\t\t\tupdateProjectionMatrix: () => void;\r\n\t\t\tposition: Vec3;\r\n\t\t\tquaternion: { x: number; y: number; z: number; w: number };\r\n\t\t\tcameraHeight: number;\r\n\t\t},\r\n\t\tcameraHeight: number,\r\n\t\tcanvas: HTMLElement,\r\n\t\tsourceParams: Partial<SourceParameters> = {}\r\n\t) {\r\n\t\tsourceParams.camera = camera;\r\n\t\tsourceParams.canvas = canvas;\r\n\r\n\t\tthis.source = new Source(sourceParams);\r\n\r\n\t\tthis.locProvider = new LocationProvider(gpsTarget, cameraHeight, (loc: LocationProvider) => {\r\n\t\t\tconst pos = loc.getLocation();\r\n\t\t\tcamera.position.x = pos.x;\r\n\t\t\tcamera.position.y = pos.y;\r\n\t\t\tcamera.position.z = pos.z;\r\n\t\t});\r\n\t\tthis.dirProvider = new DirectionProvider((dir: DirectionProvider) => {\r\n\t\t\tconst qat = dir.getDirection();\r\n\t\t\tcamera.quaternion.x = qat.x;\r\n\t\t\tcamera.quaternion.y = qat.y;\r\n\t\t\tcamera.quaternion.z = qat.z;\r\n\t\t\tcamera.quaternion.w = qat.w;\r\n\t\t});\r\n\t}\r\n\r\n\tpublic dispose() {\r\n\t\tthis.source.dispose();\r\n\t\tthis.locProvider.dispose();\r\n\t\tthis.dirProvider.dispose();\r\n\t}\r\n\r\n\tpublic getSource() {\r\n\t\treturn this.source;\r\n\t}\r\n\r\n\tpublic getLocProvider() {\r\n\t\treturn this.locProvider;\r\n\t}\r\n\r\n\tpublic getDirProvider() {\r\n\t\treturn this.dirProvider;\r\n\t}\r\n}\r\n","import { GeoMath } from \"./GeoMath\";\r\n\r\nexport class BrightnessProvider {\r\n\tprivate illuminance: number = 0;\r\n\tprivate avalible: boolean = false;\r\n\r\n\tconstructor(callback: (luxProvider: BrightnessProvider) => void = luxProvider => undefined) {\r\n\t\tif (\"AmbientLightSensor\" in window) {\r\n\t\t\t// @ts-ignore\r\n\t\t\tconst sensor = new AmbientLightSensor();\r\n\t\t\tsensor.onerror = this.onSensorError;\r\n\r\n\t\t\tsensor.onreading = () => {\r\n\t\t\t\tthis.illuminance = sensor.illuminance;\r\n\t\t\t\tthis.avalible = true;\r\n\t\t\t\tcallback(this);\r\n\t\t\t};\r\n\r\n\t\t\tsensor.start();\r\n\t\t} else {\r\n\t\t\tthis.avalible = false;\r\n\t\t\tconsole.info(\"Sensor is not supported by the User Agent.\");\r\n\t\t}\r\n\t}\r\n\r\n\tpublic isAvalible() {\r\n\t\treturn this.avalible;\r\n\t}\r\n\r\n\tpublic getIlluminance() {\r\n\t\treturn this.illuminance;\r\n\t}\r\n\r\n\tpublic getBrightness() {\r\n\t\treturn GeoMath.limit(Math.log(this.illuminance) / Math.LN10 / 5.0, 0, 1);\r\n\t}\r\n\r\n\tpublic getLightPower(multiply: number = 1) {\r\n\t\treturn 4 * GeoMath.PI * this.getBrightness() * multiply;\r\n\t}\r\n\r\n\tprivate onSensorError(event: any) {\r\n\t\t// Add SecurityError/feature policy error https://developer.mozilla.org/en-US/docs/Web/API/Sensor_APIs\r\n\t\tif (event.error.name === \"NotAllowedError\") {\r\n\t\t\t// TODO Request permission\r\n\t\t\tconsole.info(\"You need to request permission for the ambientlightsensor first\");\r\n\t\t} else if (event.error.name === \"NotReadableError\") {\r\n\t\t\tconsole.info(\"Cannot connect to the ambientlightsensor sensor\");\r\n\t\t}\r\n\t\tconsole.info(event.error.name, event.error.message);\r\n\t}\r\n}\r\n"],"sourceRoot":""}