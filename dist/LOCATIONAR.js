!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("THREE")):"function"==typeof define&&define.amd?define(["THREE"],t):"object"==typeof exports?exports.LOCATIONAR=t(require("THREE")):e.LOCATIONAR=t(e.THREE)}(window,function(e){return function(e){var t={};function i(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(n,o,function(t){return e[t]}.bind(null,o));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=6)}([function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.degToRad=function(e){return.0174532925199432*e},e.radToDeg=function(e){return 57.29577951308232*e},e.limit=function(e,t,i){return Math.max(Math.min(e,i),t)},e.getFlatCoordDistance=function(t,i){var n=this.degToRad(i.x-t.x),o=this.degToRad(i.z-t.z),r=Math.sin(n/2)*Math.sin(n/2)+Math.sin(o/2)*Math.sin(o/2)*Math.cos(t.x)*Math.cos(i.x),a=Math.atan2(Math.sqrt(r),Math.sqrt(1-r));return 2*e.EARTHRADIUS*a},e.coordTo3dSpace=function(t,i){var n=this.degToRad(t.x-i.x),o=this.degToRad(t.z-i.z),r=t.y-i.y;return{x:-(e.EARTHRADIUS*n),y:r,z:e.EARTHRADIUS*o*Math.cos(this.degToRad(i.x))}},e.coordOffsetGpsSpace=function(t,i){var n=i.x/e.EARTHRADIUS,o=i.z/Math.cos(this.degToRad(t.x))/e.EARTHRADIUS,r=t.y+i.y;return{x:t.x+this.radToDeg(n),y:r,z:t.z+this.radToDeg(o)}},e.EARTHRADIUS=6371e3,e.PI=3.141592653589793,e}();t.GeoMath=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.parameters={parent:document.body,canvas:null,onResize:null,camera:null,deviceId:null,facingMode:"environment",sourceWidth:640,sourceHeight:480,displayWidth:640,displayHeight:480},this.setParameters(e),void 0===this.parameters.canvas&&console.info("canvas have to be provided, otherwise resize won't work"),this.parameters.onResize||(this.parameters.onResize=function(e,t){e.onResizeElement(),t&&null!==t&&e.copyElementSizeTo(t)});var t=this;this.initialize().then(function(){var e=t.parameters;null!==e.camera&&(e.camera.aspect=e.sourceWidth/e.sourceHeight,e.camera.updateProjectionMatrix()),window.addEventListener("resize",function(){e.canvas&&e.onResize&&e.onResize(t,e.canvas)}),e.canvas&&e.onResize&&e.onResize(t,e.canvas)})}return e.prototype.initialize=function(){var e=this;return new Promise(function(t,i){var n=e._initSourceWebcam(function(){e.domElement?(e.onResizeElement(),e.parameters.parent.appendChild(e.domElement),t()):i("domElement not defined")},function(e){i(e)});if(n)return e.domElement=n,e.positionSourceDomElement(),e;i("Webcam source could not be established")})},e.prototype.dispose=function(){this.parameters.parent&&this.domElement&&this.parameters.parent.removeChild(this.domElement)},e.prototype.onResizeElement=function(){if(this.domElement){var e=window.innerWidth,t=window.innerHeight,i=0,n=0;this.domElement instanceof HTMLVideoElement&&(n=this.domElement.videoWidth,i=this.domElement.videoHeight);var o=n/i;if(e/t<o){var r=o*t;this.domElement.style.width=r+"px",this.domElement.style.marginLeft=-(r-e)/2+"px",this.domElement.style.height=t+"px",this.domElement.style.marginTop="0px"}else{var a=1/(o/e);this.domElement.style.height=a+"px",this.domElement.style.marginTop=-(a-t)/2+"px",this.domElement.style.width=e+"px",this.domElement.style.marginLeft="0px"}}else console.warn("Can't resize as domElement is not defined on source")},e.prototype.copyElementSizeTo=function(e){this.domElement?window.innerWidth>window.innerHeight?(e.style.width=this.domElement.style.width,e.style.height=this.domElement.style.height,e.style.marginLeft=this.domElement.style.marginLeft,e.style.marginTop=this.domElement.style.marginTop):(e.style.height=this.domElement.style.height,e.style.width=4*parseInt(e.style.height,10)/3+"px",e.style.marginLeft=(window.innerWidth-parseInt(e.style.width,10))/2+"px",e.style.marginTop="0"):console.warn("Cant set size to match domElement as it is not defined")},e.prototype._initSourceWebcam=function(e,t){var i=this,n=document.createElement("video");if(n.setAttribute("autoplay",""),n.setAttribute("muted",""),n.setAttribute("playsinline",""),n.style.width=this.parameters.displayWidth+"px",n.style.height=this.parameters.displayHeight+"px",void 0===navigator.mediaDevices||void 0===navigator.mediaDevices.enumerateDevices||void 0===navigator.mediaDevices.getUserMedia){var o="";return void 0===navigator.mediaDevices?o="navigator.mediaDevices":void 0===navigator.mediaDevices.enumerateDevices?o="navigator.mediaDevices.enumerateDevices":void 0===navigator.mediaDevices.getUserMedia&&(o="navigator.mediaDevices.getUserMedia"),void t("WebRTC issue-! "+o+" not present in your browser")}return navigator.mediaDevices.enumerateDevices().then(function(o){var r={audio:!1,video:{facingMode:i.parameters.facingMode,width:{ideal:i.parameters.sourceWidth},height:{ideal:i.parameters.sourceHeight}}};null!==i.parameters.deviceId&&(r.video.deviceId={exact:i.parameters.deviceId}),navigator.mediaDevices.getUserMedia(r).then(function(t){n.srcObject=t,document.body.addEventListener("click",function(){n.play()}),n.addEventListener("loadedmetadata",function(t){e()})}).catch(function(e){t(e)})}).catch(function(e){t(e)}),n},e.prototype.positionSourceDomElement=function(){this.domElement&&(this.domElement.style.position="absolute",this.domElement.style.top="0px",this.domElement.style.left="0px",this.domElement.style.zIndex="-2")},e.prototype.setParameters=function(e){if(e)for(var t in e)if(t){var i=e[t];if(void 0===i){console.warn(t+"' parameter is undefined.");continue}if(void 0===this.parameters[t]){console.warn(t+"' is not a property of this Source.");continue}this.parameters[t]=i}},e}();t.Source=n,t.default=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(3),o=i(4),r=function(){function e(e,t,i,n){void 0===t&&(t=2),void 0===i&&(i=function(e){}),void 0===n&&(n=!1);var r=this;if(this.localPosition=new o.Vector3,this.gpsZero=new o.Vector3,this.useGpsAltitude=!1,this.gpsOptions={enableHighAccuracy:!0,maximumAge:0,timeout:1/0},this.gpsZero=e,this.cameraHeight=t,this.useGpsAltitude=n,e||(console.info("gpsZero is required"),this.gpsZero=new o.Vector3),navigator.geolocation){this.watchID=navigator.geolocation.watchPosition(function(e){r.gpsPosition=e,r.updatePosition(),i(r)},function(e){return r.onLocationError(e,console.info)},this.gpsOptions)}else console.info("Geolocation is not supported by your browser")}return e.prototype.getLocation=function(){return this.localPosition},e.prototype.getDebug=function(){return this.gpsPosition},e.prototype.setCameraHeight=function(e){this.cameraHeight=e},e.prototype.setGpsZero=function(e){this.gpsZero=e},e.prototype.dispose=function(){this.watchID&&navigator.geolocation.clearWatch(this.watchID)},e.prototype.updatePosition=function(){if(this.gpsPosition){var e=this.gpsPosition.coords;if(e.longitude&&e.latitude){var t=e.altitude?e.altitude:0,i=this.useGpsAltitude?t:this.cameraHeight,r=new o.Vector3(e.latitude,i,e.longitude),a=new n.GpsLocation(r,this.gpsZero);this.localPosition=new o.Vector3(-a.x,a.y,a.z)}}},e.prototype.onLocationError=function(e,t){switch(e.code){case e.PERMISSION_DENIED:t("User denied permission for Geolocation");break;case e.POSITION_UNAVAILABLE:t("Location information is unavailable");break;case e.TIMEOUT:t("The request to get user location timedout");break;default:throw e}},e}();t.LocationProvider=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(0),o=function(){return function(e,t){var i=n.GeoMath.coordTo3dSpace(e,t);this.x=i.x,this.y=i.y,this.z=i.z}}();t.GpsLocation=o},function(t,i){t.exports=e},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(0),o=i(4),r=function(){function e(e){void 0===e&&(e=function(e){}),this.alphaOffset=n.GeoMath.degToRad(-90),this.enabled=!0,this.debug={alpha:0,beta:0,gamma:0,absolute:!1},this.quaternion=new o.Quaternion,this.targetQuanternion=new o.Quaternion,this.screenOrientation=0,this.zee=new o.Vector3(0,0,1),this.euler=new o.Euler,this.q0=new o.Quaternion,this.q1=new o.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5));var t=this;this.onDeviceOrientationChangeEvent=function(i){t.updateDeviceOrientation(i),e(t)},this.onScreenOrientationChangeEvent=function(){t.screenOrientation=window.orientation||0},this.connect()}return e.prototype.getDirection=function(){return this.quaternion},e.prototype.getDebug=function(){return this.debug},e.prototype.updateDeviceOrientation=function(e){if(this.enabled&&e){var t=e.absolute,i=e.alpha?n.GeoMath.degToRad(e.alpha):0,o=e.beta?n.GeoMath.degToRad(e.beta):0,r=e.gamma?n.GeoMath.degToRad(e.gamma):0;this.debug={alpha:i,beta:o,gamma:r,absolute:t};var a=this.screenOrientation?n.GeoMath.degToRad(this.screenOrientation):0;this.setObjectQuaternion(i+this.alphaOffset,o,r,a)}},e.prototype.dispose=function(){this.disconnect()},e.prototype.setObjectQuaternion=function(e,t,i,n){this.euler.set(t,e,-i,"YXZ"),this.targetQuanternion.setFromEuler(this.euler),this.targetQuanternion.multiply(this.q1),this.targetQuanternion.multiply(this.q0.setFromAxisAngle(this.zee,-n)),this.quaternion.slerp(this.targetQuanternion,Math.min(10*this.quaternion.angleTo(this.targetQuanternion),.8))},e.prototype.connect=function(){this.onScreenOrientationChangeEvent(),window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent,!1),window.addEventListener("deviceorientationabsolute",this.onDeviceOrientationChangeEvent,!1),this.enabled=!0},e.prototype.disconnect=function(){window.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent,!1),window.removeEventListener("deviceorientationabsolute",this.onDeviceOrientationChangeEvent,!1),this.enabled=!1},e}();t.DirectionProvider=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(1);t.Source=n.Source;var o=i(7);t.Controller=o.Controller;var r=i(2);t.LocationProvider=r.LocationProvider;var a=i(5);t.DirectionProvider=a.DirectionProvider;var s=i(8);t.BrightnessProvider=s.BrightnessProvider;var c=i(3);t.GpsLocation=c.GpsLocation;var u=i(0);t.GeoMath=u.GeoMath},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(1),o=i(2),r=i(5),a=function(){function e(e,t,i,a,s){void 0===s&&(s={}),s.camera=t,s.canvas=a,this.source=new n.Source(s),this.locProvider=new o.LocationProvider(e,i,function(e){var i=e.getLocation();t.position.x=i.x,t.position.y=i.y,t.position.z=i.z}),this.dirProvider=new r.DirectionProvider(function(e){var i=e.getDirection();t.quaternion.x=i.x,t.quaternion.y=i.y,t.quaternion.z=i.z,t.quaternion.w=i.w})}return e.prototype.dispose=function(){this.source.dispose(),this.locProvider.dispose(),this.dirProvider.dispose()},e.prototype.getSource=function(){return this.source},e.prototype.getLocProvider=function(){return this.locProvider},e.prototype.getDirProvider=function(){return this.dirProvider},e}();t.Controller=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(0),o=function(){function e(e){void 0===e&&(e=function(e){});var t=this;if(this.illuminance=0,this.avalible=!1,"AmbientLightSensor"in window){var i=new AmbientLightSensor;i.onerror=this.onSensorError,i.onreading=function(){t.illuminance=i.illuminance,t.avalible=!0,e(t)},i.start()}else this.avalible=!1,console.info("Sensor is not supported by the User Agent.")}return e.prototype.isAvalible=function(){return this.avalible},e.prototype.getIlluminance=function(){return this.illuminance},e.prototype.getBrightness=function(){return n.GeoMath.limit(Math.log(this.illuminance)/Math.LN10/5,0,1)},e.prototype.getLightPower=function(e){return void 0===e&&(e=1),4*n.GeoMath.PI*this.getBrightness()*e},e.prototype.onSensorError=function(e){"NotAllowedError"===e.error.name?console.info("You need to request permission for the ambientlightsensor first"):"NotReadableError"===e.error.name&&console.info("Cannot connect to the ambientlightsensor sensor"),console.info(e.error.name,e.error.message)},e}();t.BrightnessProvider=o}])});
//# sourceMappingURL=LOCATIONAR.js.map